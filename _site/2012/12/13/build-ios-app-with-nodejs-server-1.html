<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Levey write here</title>
  <meta name="author" content="Levey" />
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/skeleton.css">
  <link rel="stylesheet" href="/css/screen.css">
  <link rel="stylesheet" href="/css/layout.css">
  <link rel="stylesheet" href="/fonts/font-awesome.css">

</head>
<body>
  <div class="container">
    <div class="four columns sidebar">
      <nav>
        <h2>Levey</h2>
        <ul>
        <p>吾乃一介软件开发者。</p>
        <p>吾在此分享我的生活以及工作中的思考和经历。</p>
        <p>Generating skill list...</p>
        <p>iOS</p> <p>Ruby on Rails</p> <p>Node.js</p> <p>kukuku...</p>
        

        <p style="margin-bottom: 10px;">
          Follow me:
          <div id="stalker">
            <a title="Levey on Github" target = "_blank" href="http://github.com/levey/"><i class="icon-github icon-large"></i></a>
            <a title="Levey on Twitter" target = "_blank" href="http://twitter.com/leveyzhu"><i class="icon-twitter icon-large"></i></a>
            <a title="RSS feed" target = "_blank" href="/atom.xml"><i class="icon-rss icon-large"></i></a>
          </div>
        </p>
        </ul>
      </nav>
    </div>

    <div class="eleven columns content">
      <p class="meta">
<a href="/"><i class="home icon-home"></i></a>
</p>
<h2 class="title">iOS / node.js 贯穿 iOS app 前后端教程(一)</h2>

 <p class="signature"></p>
<div id="post">
<h4 id='id1'>说明</h4>

<p>这是一篇很基础的教程，全篇通过制作一个叫 WhateverNote 的 app，来描述 iOS app 的前端和服务端交互的。</p>

<h4 id='__'>语言 / 框架</h4>

<p>iOS 端用到的语言就是 Objective-C, 为了方便我选择 AFNetowrking 作为 HTTP 库 。服务器端本来想用 Ruby on Rails 或者 Sinatra 的，但是后来想试一试 Node.js 的体验，所以就用 Node.js了，选择的 web framework 是 express.js, 跟 Sinatra 是类似的，都比较轻量级。</p>

<h4 id='id2'>工具</h4>

<p>iOS: <code>Xcode</code></p>

<p>Node.js: <code>Sublime Text 2</code> / <code> iTerm 2</code></p>
<hr />
<h4 id='whatevernote__server'>WhateverNote - Server</h4>

<p>先从 <a href='http://nodejs.org'>http://nodejs.org</a> 下载安装 Node.js，我当前的最新稳定版本为 v0.8.15。</p>

<p>安装 Node.js 成功后，通过终端安装 experess.js, -g 参数表示安装的包为全局的。</p>

<pre><code>npm install -g express</code></pre>

<p>安装 express.js 成功后， 在 WhateverNote 目录下新建一个 Whatever-server 的项目</p>

<pre><code>express Whatever-server</code></pre>

<p>进入刚建立的项目的目录 执行</p>

<pre><code>node app.js </code></pre>

<p>然后用浏览器打开 localhost:3000 就能看到 express 的欢迎页面了。</p>

<p>然后我们看一下 app.js 这个文件，</p>

<pre><code>var express = require(&#39;express&#39;)
 , routes = require(&#39;./routes&#39;)
 , user = require(&#39;./routes/user&#39;)
 , http = require(&#39;http&#39;)
 , path = require(&#39;path&#39;);

var app = express();</code></pre>

<p>这些是一些变量，express 是以文件目录的形式来定义类型的。</p>

<pre><code>app.configure(function(){
  app.set(&#39;port&#39;, process.env.PORT || 3000);
  app.set(&#39;views&#39;, __dirname + &#39;/views&#39;);
  app.set(&#39;view engine&#39;, &#39;jade&#39;);
  app.use(express.favicon());
  app.use(express.logger(&#39;dev&#39;));
  app.use(express.bodyParser());
  app.use(express.methodOverride());
  app.use(app.router);
  app.use(express.static(path.join(__dirname, &#39;public&#39;)));
});</code></pre>

<p>这些是对 express 的配置。</p>

<p>接下来</p>

<pre><code>app.get(&#39;/&#39;, routes.index);</code></pre>

<p>这一行就是对刚才访问到的主页的处理。</p>

<p>最后</p>

<pre><code>http.createServer(app).listen(app.get(&#39;port&#39;), function(){
  console.log(&quot;Express server listening on port &quot; + app.get(&#39;port&#39;));
});</code></pre>

<p>就是服务器的创建，因为 Node.js 运行环境本身可以作为 web server，所以不用 apache/nginx 等类似的 web server.</p>

<p>我们的程序结构用 MVC + Routes，类似 Ruby on Rails, 但是我们只是需要的是 iOS 端获得 JSON 数据，所以我们可以去掉 View 这一层（删掉 views 目录）。</p>

<p>然后新建 models 和 conterllers 目录，分别在刚建的目录里新建 note.js 文件。</p>

<p>我喜欢用单个文件来做 URL 路由， 所以删除了 routes 目录，新建 routes.js 代替。</p>

<p>在 <strong>controllers/note.js</strong> 写上如下代码</p>

<pre><code>exports.index = function (req, res) {
  res.send(&#39;hello world&#39;);
};</code></pre>

<p>然后在 <strong>routes.js</strong> 写下如下代码</p>

<pre><code>var note = require(&#39;./controllers/note&#39;)

exports.route = function (app) {
  app.get(&#39;/notes&#39;, note.index);
};</code></pre>

<p>最后在 <strong>app.js</strong> 中 把那些 express 的默认建立的 user 变量删除，然后用以下代码替换原来的路由代码。</p>

<pre><code>routes.route(app);
// app.get(&#39;/&#39;, routes.index);</code></pre>

<p>然后重新启动 Server (node app.js)，我们就可以看到主页只输出 hello world 字符串。</p>

<p><strong>&#8211; 未完待续</strong></p>

 <p class="signature">2012-12-13  written by levey </p>
</div>

<div id="related">
  <h3>Related Posts</h3>
  <ul class="posts">
    
    <li><span>2012-11-06 &raquo;</span> <a href="/blog/2012/11/06/migrate-postgresql-data-from-linode-to-heroku.html">从 Linode 导出 PostgreSQL 数据到 Heroku</a></li>
    
  </ul>
</div>


       <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'levey'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>




    
<!--       <div class="footer">
          <div class="disclaimer">
          <p>The postings on this site are my own and don't necessarily represent my 
          employer’s positions, strategies or opinions.</p>
        </div>
      </div> -->
    </div>
  </div>

<!-- <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-13005539-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script> -->

</body>
</html>
