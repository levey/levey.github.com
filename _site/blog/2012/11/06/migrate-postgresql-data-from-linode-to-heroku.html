<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Levey write here</title>
  <meta name="author" content="Levey" />
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/skeleton.css">
  <link rel="stylesheet" href="/css/screen.css">
  <link rel="stylesheet" href="/css/layout.css">
  <link rel="stylesheet" href="/fonts/font-awesome.css">

</head>
<body>
  <div class="container">
    <div class="four columns sidebar">
      <nav>
        <h2>Levey</h2>
        <ul>
        <p>我是一个 iOS 软件开发者，并同时喜欢 Rails,  Node.js 等 Web 技术。</p>
        <p>
          我将会在这个网站分享我的生活以及工作中的思考和经历。
        </p>

        <p style="margin-bottom: 10px;">
          Follow me:
          <div id="stalker">
            <a title="Levey on Github" target = "_blank" href="http://github.com/levey/"><i class="icon-github icon-large"></i></a>
            <a title="Levey on Twitter" target = "_blank" href="http://twitter.com/leveyzhu"><i class="icon-twitter icon-large"></i></a>
            <a title="RSS feed" target = "_blank" href="/atom.xml"><i class="icon-rss icon-large"></i></a>
          </div>
        </p>
        </ul>
      </nav>
    </div>

    <div class="eleven columns content">
      <p class="meta"> November 06, 2012 
<a href="/"><i class="home icon-home"></i></a>
</p>
<h1 class="title">从 Linode 导出 PostgreSQL 数据到 Heroku</h1>


<div id="post">
<h4 id='id1'>前言</h4>

<p>这篇博客意在帮助有想从 Linode 迁移网站到 Heroku 的读者.</p>

<p>一星期前，我的网站 <a href='http://coderxcoder.com'>coderxcoder</a> 想从 Linode 迁移到 Heroku, 本来像尝试 使 用 ruby 的 taps 这个 gem 来迁移，但是无奈失败多次，最后使用此篇博客中的方法。</p>

<p>本篇使用到的手段有:</p>

<ol>
<li>使用 <a href='http://www.postgresql.org/docs/7.3/static/app-pgdump.html'>pg_dump</a> 备份 PostgreSQL 数据。</li>

<li>Nginx 公开备份好的文件。</li>

<li>使用 <a href='https://devcenter.heroku.com/articles/pgbackups'>pgbackups</a> 这个 Heroku 的插件来导入并更新数据库。</li>
</ol>

<h5 id='1'>1.备份数据库</h5>

<p>首先 SSH 连接到 Linode 服务器, 输入命令</p>

<pre><code>PGPASSWORD=[您的PG密码] pg_dump -Fc --no-acl --no-owner -h 127.0.0.1 -U [您的PG用户名] 
[需要导出的数据库名] &gt; mydb.dump</code></pre>

<p>导出的 mydb.dump 就是 之后需要用到的备份文件。</p>

<h5 id='2_nginx_'>2. Nginx 公开数据库备份文件</h5>

<p>首先， 在 /var/www 里新建一个 dbbackup 的目录下</p>

<pre><code>sudo mkdir /var/www/dbbackup</code></pre>

<p>然后， 在 /etc/nginx/sites-available 目录下 新建一个 dbbackup.conf 的文件</p>

<pre><code>sudo touch /etc/nginx/sites-available/dbbackup.conf</code></pre>

<p>再然后， 在 dbbackup.conf 里输入以下配置</p>

<pre><code>server
{
	server_name [你的服务器的域名或者IP];
	listen 7000;
	access_log off;
	root /var/www/dbbackup;

	location  /  {
    	autoindex  on;
	}
}</code></pre>

<p>再然后，链接到 sites-enabled 目录</p>

<pre><code>ln -s /etc/nginx/sites-available/dbbackup.conf /etc/nginx/sites-enabled/dbbackup.conf</code></pre>

<p>再然后，重启 nginx</p>

<pre><code>sudo /etc/init.d/ngnix restart</code></pre>

<h5 id='3_'>3. 恢复数据库</h5>

<p>这个很简单，按照 Heroku 的教程就好了，在你的项目目录里</p>

<pre><code>heroku pgbackups:restore DATABASE [第二步公开的数据库备份文件地址]</code></pre>
</div>

<div id="related">
  <h3>Related Posts</h3>
  <ul class="posts">
    
  </ul>
</div>

    
<!--       <div class="footer">
          <div class="disclaimer">
          <p>The postings on this site are my own and don't necessarily represent my 
          employer’s positions, strategies or opinions.</p>
        </div>
      </div> -->
    </div>
  </div>

<!-- <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-13005539-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script> -->

</body>
</html>
